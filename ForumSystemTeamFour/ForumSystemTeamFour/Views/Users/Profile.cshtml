@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using ForumSystemTeamFour.Models;
@using System.IO;

@model User;
@{
    string loggedUserId = User.Claims.FirstOrDefault(claim => claim.Type == "LoggedUserId").Value;
    string loggedUsername = User.Claims.FirstOrDefault(claim => claim.Type == "Username").Value;
    bool ownProfile = loggedUsername == Model.Username;   
    
    string welcomeMessage = ownProfile ? $"Welcome, {loggedUsername}!": $"{Model.Username}'s profile.";
    string statsMessage = ownProfile ? "Your activity history:" : $"{Model.Username}'s activity history:";
    string userThreadsMessage = ownProfile ? "Show your threads" : $"Show {Model.Username}'s threads";
    string userPostsMessage = ownProfile ? "Show your posts" : $"Show {Model.Username}'s posts";
    int totalThreads = Model.Threads.Count();
    int totalPosts = Model.Replies.Count();
    bool hasProfilePic = File.Exists($"wwwroot/ProfilePictures/{Model.Username}.jpg");
    string profilePicName = hasProfilePic ? $"{Model.Username}.jpg" : "default.jpg";

}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Paranormality - Main page</title>
    <link rel="stylesheet" href="~/css/bootstrap.css" />
    <link rel="stylesheet" href="~/css/application.css" />
    <style>

    </style>
</head>

<body >

    <header>
        <h2 class="appHeadingText">PARANORMALITY</h2>
        <div class="topnav">
            
            <a asp-controller="Home" asp-action="Index">Home</a>
            <a asp-controller="Threads" asp-action="Index">All discussions</a>
            <a asp-controller="Threads" asp-action="Create">Start topic</a>
            <a asp-controller="Users" asp-action="Profile" asp-route-id="@loggedUserId">Your profile</a>
            <a asp-controller="Users" asp-action="Logout">Logout</a>
            <a href="/api/swagger" style="right:10%;">Admin API access</a>
        </div>
    </header>
    
    <div class="appBelowHeader">
        @welcomeMessage
        <div>
            <img src="/ProfilePictures/@profilePicName" class="appProfilePicture" /><br />
            @statsMessage<br />
            Threads created: @totalThreads<br />
            Total posts: @totalPosts <br />
        </div>
        
        <form class="appCentered" style="transform: translate(0%, -50%); left:42%" 
        asp-controller="Users" asp-action="Register" method="post">

            <div>
                <br>
                <label asp-for="FirstName">First name:</label>
                <br>
                <input asp-for="FirstName" type="text" value="@Model.FirstName" placeholder="John">
                <span asp-validation-for="FirstName" class="form-error" style="color:#FFFF33;"></span>
            </div>

            <div>
                <label asp-for="LastName">LastName:</label><br>
                <input asp-for="LastName" type="text" value="@Model.LastName" placeholder="Doe">
                <span asp-validation-for="LastName" class="form-error" style="color:#FFFF33"></span>
            </div>

            <div>
                <label asp-for="Email">E-Mail:</label><br>
                <input asp-for="Email" type="text" value="@Model.Email" placeholder="John@Doe.com">
                <span asp-validation-for="Email" class="form-error" style="color:#FFFF33;"></span>
            </div>

            <div>
                <label asp-for="Username">Username:</label><br>
                <input asp-for="Username" type="text" value="@Model.Username" placeholder="Doejon69">
                <span asp-validation-for="Username" class="form-error" style="color:#FFFF33;"></span>
            </div>

            <div>
                <label asp-for="Password">Password:</label><br>
                <input asp-for="Password" type="password" value="@Model.Password" placeholder="123">
                <span asp-validation-for="Password" class="form-error" style="color:#FFFF33;"></span>
            </div>

            <div>
                <label asp-for="ConfirmPassword">Confirm password:</label><br>
                <input asp-for="ConfirmPassword" type="password" value="@Model.ConfirmPassword" placeholder="123">
                <span asp-validation-for="ConfirmPassword" class="form-error" style="color:#FFFF33;left:10%;"></span>
            </div>

            <div>
                <br /><input type="submit" value="Register"
                             class="btn appbtn-outline" style="text-decoration:none">&nbsp
                <a asp-controller="Home" asp-action="Index"
                   type="button" class="btn appbtn-outline" style="text-decoration:none">Reconsider...</a>
            </div>
        </form>
            
            
         
    
    </div>
    
    
    <div class="appAboveFooter">
        @if (totalThreads > 0)
        {
            <a asp-controller="" asp-action="">@userThreadsMessage</a>

        }
        <br />
        @if (totalPosts > 0)
        {
            <a asp-controller="" asp-action="">@userPostsMessage</a>
        }
    </div>
    <footer>

        <div style="text-align:center;padding:10px;margin-top:7px;">
            © copyright Paranormality.com
        </div>
    </footer>

</body>
</html>